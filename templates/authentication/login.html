{% extends 'base.html' %}

{% block title %}Login - CommerceBox{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .login-card {
        max-width: 400px;
        width: 100%;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    .login-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px 15px 0 0;
        text-align: center;
    }
    
    .login-body {
        padding: 2rem;
    }
    
    .btn-login {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px;
        font-weight: 600;
    }
    
    .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
</style>
{% endblock %}

{% block content %}
<div class="login-card">
    <div class="login-header">
        <i class="bi bi-box-seam" style="font-size: 3rem;"></i>
        <h2 class="mt-2">CommerceBox</h2>
        <p class="mb-0">Sistema de Gestión Comercial</p>
    </div>
    
    <div class="login-body">
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">
                    <i class="bi bi-person"></i> Usuario
                </label>
                <input type="text" class="form-control" id="username" required autofocus>
            </div>
            
            <div class="mb-3">
                <label for="password" class="form-label">
                    <i class="bi bi-lock"></i> Contraseña
                </label>
                <input type="password" class="form-control" id="password" required>
            </div>
            
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rememberMe">
                <label class="form-check-label" for="rememberMe">
                    Recordarme
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary btn-login w-100">
                <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión
            </button>
        </form>
        
        <div class="text-center mt-3">
            <a href="#" class="text-muted text-decoration-none">
                <small>¿Olvidaste tu contraseña?</small>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const submitBtn = e.target.querySelector('button[type="submit"]');
    
    // Deshabilitar botón
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Iniciando...';
    
    try {
        const result = await auth.login(username, password);
        
        if (result.success) {
            showAlert('¡Login exitoso! Redirigiendo...', 'success');
            setTimeout(() => {
                window.location.href = '/dashboard/';
            }, 1000);
        } else {
            showAlert(result.error, 'danger');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión';
        }
    } catch (error) {
        showAlert('Error de conexión. Intente nuevamente.', 'danger');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión';
    }
});

// Si ya está autenticado, redirigir
if (auth.isAuthenticated()) {
    window.location.href = '/dashboard/';
}
</script>
{% endblock %}